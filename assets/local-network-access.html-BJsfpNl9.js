import{_ as a,c as t,i as s,o}from"./app-BLUMuPoP.js";const r="/CrabSAMA-Blog/assets/image-20251210144745560-F_Q2DGd7.png",c="/CrabSAMA-Blog/assets/img_v3_02sr_9f747062-2e81-4232-b844-403f0d3c445g-6A_OadDv.jpg",n="/CrabSAMA-Blog/assets/example-BLdnY2Ab.png",i={};function l(p,e){return o(),t("div",null,e[0]||(e[0]=[s(`<h1 id="local-network-access" tabindex="-1"><a class="header-anchor" href="#local-network-access"><span>Local Network Access</span></a></h1><p>LNA 是 chrome 从 142 版本开始默认启用的一个功能，简单来说，LNA 出于保护本地服务的目的，会阻拦公网网站向本地网络发起的请求。本地网络的概念可以参考这个<a href="https://wicg.github.io/local-network-access/#non-public-ip-address-blocks" target="_blank" rel="noopener noreferrer">链接</a>。</p><blockquote><p>一些参考资料：</p><p><a href="https://developer.chrome.com/blog/local-network-access?hl=zh-cn" target="_blank" rel="noopener noreferrer">chrome blog</a></p><p><a href="https://chromestatus.com/feature/5152728072060928" target="_blank" rel="noopener noreferrer">chrome status</a></p><p><a href="https://docs.google.com/document/d/1QQkqehw8umtAgz5z0um7THx-aoU251p705FbIQjDuGs/edit?tab=t.0#heading=h.v8oobsqxbxxy" target="_blank" rel="noopener noreferrer">LNA Adoption Guide</a></p></blockquote><div class="language-mermaid line-numbers-mode" data-highlighter="shiki" data-ext="mermaid" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-mermaid"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">flowchart TD</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    A[公网网站页面] --&gt;|发起请求| B[请求本地网络服务]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    B --&gt; C{LNA 策略生效?}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    C --&gt;|否| D[请求成功]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    C --&gt;|是| E{是否允许 local-network-access?}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    E --&gt;|允许| D</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    E --&gt;|拒绝或未授予| F[请求被阻止&lt;br/&gt;显示权限提示框或错误信息]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如上图所示，当公网页面尝试访问本地网络服务时，Chrome 会根据 LNA 策略判断是否需要拦截，并根据用户是否授予 <code>local-network-access</code> 权限来决定请求最终是否能被执行。</p><p>一般来说，在公司内部有不少系统都会受到这个策略的影响。当前可以分为几种情况。</p><h2 id="navigating-subframes-导航子帧" tabindex="-1"><a class="header-anchor" href="#navigating-subframes-导航子帧"><span>Navigating subframes 导航子帧</span></a></h2><p>举个最简单的例子，公司内部会用到飞书的 SSO 授权登录，当飞书登录成功后会回调回来内部系统的网站，内部系统的网站是部署在 172 网段的，这就是一个很典型的外网访问内网请求的 case。在 chrome 142 版本后，这种情况就会被 LNA 阻拦掉，现象如下：</p><figure><img src="`+r+'" alt="image-20251210144745560" tabindex="0" loading="lazy"><figcaption>image-20251210144745560</figcaption></figure><p>提示「此连接已被阻止，因为它是公共页面发起的，旨在连接到您本地网络上的设备或服务器」。</p><p>我们可以在采用指南上找到如下描述：</p><figure><img src="'+c+'" alt="img_v3_02sr_9f747062-2e81-4232-b844-403f0d3c445g" tabindex="0" loading="lazy"><figcaption>img_v3_02sr_9f747062-2e81-4232-b844-403f0d3c445g</figcaption></figure><p>针对这种情况，我们需要将内网地址和外网地址都部署在 https 下，然后给 iframe 添加 <code>allow=&quot;local-network-access&quot;</code> 相关属性，此时当再次发生跳转的时候，就会弹出提示请求权限：</p><figure><img src="'+n+'" alt="显示“查找并连接到本地网络上的任何设备”文本的提示。" tabindex="0" loading="lazy"><figcaption>显示“查找并连接到本地网络上的任何设备”文本的提示。</figcaption></figure><p>此时只要用户允许了这个权限，我们就能和以前一样正常进行跳转。但如果用户拒绝了，跳转将被阻止，出现和上面一样的错误。</p><h2 id="资源请求" tabindex="-1"><a class="header-anchor" href="#资源请求"><span>资源请求</span></a></h2><p>针对一些资源的请求（image/video等）和 fetch 请求，也会被 LNA 限制。</p><p>和上面聊到的一样，当发起此类请求的时候会有权限请求的提示框，如果权限没有被授予，此类请求就会被禁止请求，并在控制台中显示 CORS 错误。</p><h2 id="最佳实践" tabindex="-1"><a class="header-anchor" href="#最佳实践"><span>最佳实践</span></a></h2><p>针对用户权限请求，和其他权限（麦克风、定位等）请求一样，我们需要在用户请求前给予提示，引导用户允许请求，如果判断到用户拒绝了权限，也做一个优雅的降级，阻断当前行为并提示用户这个权限的重要性，并告诉用户如何重置权限（因为当前浏览器并没有提供编程式重置权限的途径，需要用户手动重置）。</p><p>这相关的内容在 web 体验优化相关的文章中会提到，可以自行展开研究。</p><p>由于 LNA 一般影响面最大在企业内部，企业也可以通过策略的方式，调整 <code>LocalNetworkAccessAllowedForUrls</code> 和 <code>LocalNetworkAccessBlockedForUrls</code> 两个参数来针对性的开放或拦截。使用通配符的方式，可以一次性将公司的二级域名都匹配上，一次性解决问题。</p><p>临时的解决方案也可以通过访问 <code>chrome://flags</code>，将 <code>Local Network Access Checks</code> 这一项 disabled 掉，也能临时解决问题。但是建议还是针对 LNA 做相关的适配，也许以后这个功能就常驻开放了。</p><hr><p>总的来说，LNA 这个功能的出发点是好的，针对大多数普通浏览器用户可以有效地减少被攻击的可能性，对于有可能遭受影响的企业用户，也有提供对应的解决方案去解决，就是需要开发者针对这个 case 来进行一些适配，作为开发者的我们可以多关注一下 chrome 的一些新特性，等到用户反馈遇到情况再去修复就晚啦。</p>',25)]))}const h=a(i,[["render",l]]),g=JSON.parse('{"path":"/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/local-network-access.html","title":"Local Network Access","lang":"zh-CN","frontmatter":{"title":"Local Network Access","date":"2025-12-10T08:02:52.000Z","category":["学习笔记"],"tag":["浏览器","踩坑"],"description":"Local Network Access LNA 是 chrome 从 142 版本开始默认启用的一个功能，简单来说，LNA 出于保护本地服务的目的，会阻拦公网网站向本地网络发起的请求。本地网络的概念可以参考这个链接。 一些参考资料： chrome blog chrome status LNA Adoption Guide 如上图所示，当公网页面尝试访...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Local Network Access\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-12-10T08:02:52.000Z\\",\\"dateModified\\":\\"2025-12-10T08:09:52.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"CrabSAMA\\",\\"url\\":\\"https://crabsama.github.io/CrabSAMA-Blog\\"}]}"],["meta",{"property":"og:url","content":"https://crabsama.github.io/CrabSAMA-Blog/CrabSAMA-Blog/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/local-network-access.html"}],["meta",{"property":"og:site_name","content":"CrabSAMA · 笔记"}],["meta",{"property":"og:title","content":"Local Network Access"}],["meta",{"property":"og:description","content":"Local Network Access LNA 是 chrome 从 142 版本开始默认启用的一个功能，简单来说，LNA 出于保护本地服务的目的，会阻拦公网网站向本地网络发起的请求。本地网络的概念可以参考这个链接。 一些参考资料： chrome blog chrome status LNA Adoption Guide 如上图所示，当公网页面尝试访..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-10T08:09:52.000Z"}],["meta",{"property":"article:tag","content":"踩坑"}],["meta",{"property":"article:tag","content":"浏览器"}],["meta",{"property":"article:published_time","content":"2025-12-10T08:02:52.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-10T08:09:52.000Z"}]]},"git":{"createdTime":1765354192000,"updatedTime":1765354192000,"contributors":[{"name":"CrabSAMA","username":"CrabSAMA","email":"71915282@qq.com","commits":1,"url":"https://github.com/CrabSAMA"}]},"readingTime":{"minutes":3.76,"words":1128},"filePathRelative":"学习笔记/local-network-access.md","excerpt":"\\n<p>LNA 是 chrome 从 142 版本开始默认启用的一个功能，简单来说，LNA 出于保护本地服务的目的，会阻拦公网网站向本地网络发起的请求。本地网络的概念可以参考这个<a href=\\"https://wicg.github.io/local-network-access/#non-public-ip-address-blocks\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">链接</a>。</p>\\n<blockquote>\\n<p>一些参考资料：</p>\\n<p><a href=\\"https://developer.chrome.com/blog/local-network-access?hl=zh-cn\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">chrome blog</a></p>\\n<p><a href=\\"https://chromestatus.com/feature/5152728072060928\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">chrome status</a></p>\\n<p><a href=\\"https://docs.google.com/document/d/1QQkqehw8umtAgz5z0um7THx-aoU251p705FbIQjDuGs/edit?tab=t.0#heading=h.v8oobsqxbxxy\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">LNA Adoption Guide</a></p>\\n</blockquote>","autoDesc":true}');export{h as comp,g as data};
