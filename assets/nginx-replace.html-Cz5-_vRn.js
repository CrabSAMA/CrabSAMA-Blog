import{_ as i,c as n,i as t,o as s}from"./app-Cj_mfYJ5.js";const a={};function o(c,e){return s(),n("div",null,e[0]||(e[0]=[t(`<h2 id="背景" tabindex="-1"><a class="header-anchor" href="#背景"><span>背景</span></a></h2><p>公司大前端提供的平台里看到了一个功能，在代码中写特定的链接，例如 <code>__REPLACE__</code>，在实际访问时会替换成指定内容，来实现 <code>CDN</code> 的功能。在看到这个功能后，对它具体是怎么实现的比较好奇，因此看看具体是怎么操作的。</p><h2 id="实操" tabindex="-1"><a class="header-anchor" href="#实操"><span>实操</span></a></h2><p><code>nginx</code> 提供了 <code>sub_filter</code> 模块来实现重写 content 的功能。</p><p>我们需要找到 <code>nginx</code> 的安装目录，进入其 <code>conf</code> 文件夹，打开 <code>nginx.conf</code> 配置文件。</p><p>找到 <code>location / { … }</code> 这一行，这里是代理默认请求到 <code>index.html</code> ：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-nginx"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    proxy_set_header </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Accept-Encoding </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    sub_filter </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;__NGINX_REPLACE__&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;Replace Content&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    sub_filter_types </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">text/html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    sub_filter_once </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">off</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    index </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">index.html index.htm;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>来解释一下具体的配置内容：</p><p><code>sub_filter &#39;__NGINX_REPLACE__&#39; &#39;Replace Content&#39;;</code> —— 这个实际将 <code>index.html</code> 中 <code>__NGINX_REPLACE__</code> 替换成 <code>Replace Content</code> 。</p><p>注意只有在新版本 <code>nginx</code> 中才支持多 <code>sub_filter</code>。</p><p><code>sub_filter_types *;</code> -- 只对 <code>text/html</code> 响应类型做<code>sub_filter</code> 指定的替换。</p><p><code>sub_filter_once off;</code> -- <code>sub_filter</code> 会执行<strong>多次</strong>而不是一次. 效果类似于 <code>java</code> 中的 <code>string.replaceAll</code> 而不是 <code>replace</code>。</p><p><code>proxy_set_header Accept-Encoding &quot;&quot;;</code> -- 设置这个得原因是告诉后端不要进行 <code>gzip</code> 压缩。如果是 <code>gzip</code> 压缩流, 那么我们就没法进行替换了。</p><h2 id="进阶" tabindex="-1"><a class="header-anchor" href="#进阶"><span>进阶</span></a></h2><p><code>nginx</code> 有一个增强模块 <code>ngx_http_substitutions_filter_module</code>，可以支持更多高级功能：</p><ol><li>支持多次替换</li><li>支持正则替换</li><li>支持中文替换</li></ol><p>具体使用方法可以直接看文档，此处不多赘述。</p>`,17)]))}const l=i(a,[["render",o]]),p=JSON.parse('{"path":"/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/nginx-replace.html","title":"使用 nginx 实现内容替换","lang":"zh-CN","frontmatter":{"title":"使用 nginx 实现内容替换","date":"2022-07-28T09:19:53.000Z","category":["解决方案"],"tag":["nginx","前端工程化"],"description":"背景 公司大前端提供的平台里看到了一个功能，在代码中写特定的链接，例如 __REPLACE__，在实际访问时会替换成指定内容，来实现 CDN 的功能。在看到这个功能后，对它具体是怎么实现的比较好奇，因此看看具体是怎么操作的。 实操 nginx 提供了 sub_filter 模块来实现重写 content 的功能。 我们需要找到 nginx 的安装目录，...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"使用 nginx 实现内容替换\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-07-28T09:19:53.000Z\\",\\"dateModified\\":\\"2024-08-17T14:39:40.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"CrabSAMA\\",\\"url\\":\\"https://crabsama.github.io/CrabSAMA-Blog\\"}]}"],["meta",{"property":"og:url","content":"https://crabsama.github.io/CrabSAMA-Blog/CrabSAMA-Blog/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/nginx-replace.html"}],["meta",{"property":"og:site_name","content":"CrabSAMA · 笔记"}],["meta",{"property":"og:title","content":"使用 nginx 实现内容替换"}],["meta",{"property":"og:description","content":"背景 公司大前端提供的平台里看到了一个功能，在代码中写特定的链接，例如 __REPLACE__，在实际访问时会替换成指定内容，来实现 CDN 的功能。在看到这个功能后，对它具体是怎么实现的比较好奇，因此看看具体是怎么操作的。 实操 nginx 提供了 sub_filter 模块来实现重写 content 的功能。 我们需要找到 nginx 的安装目录，..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-17T14:39:40.000Z"}],["meta",{"property":"article:tag","content":"前端工程化"}],["meta",{"property":"article:tag","content":"nginx"}],["meta",{"property":"article:published_time","content":"2022-07-28T09:19:53.000Z"}],["meta",{"property":"article:modified_time","content":"2024-08-17T14:39:40.000Z"}]]},"git":{"createdTime":1659000720000,"updatedTime":1723905580000,"contributors":[{"name":"CrabSAMA","username":"CrabSAMA","email":"71915282@qq.com","commits":7,"url":"https://github.com/CrabSAMA"}]},"readingTime":{"minutes":1.29,"words":388},"filePathRelative":"解决方案/nginx-replace.md","excerpt":"<h2>背景</h2>\\n<p>公司大前端提供的平台里看到了一个功能，在代码中写特定的链接，例如 <code>__REPLACE__</code>，在实际访问时会替换成指定内容，来实现 <code>CDN</code> 的功能。在看到这个功能后，对它具体是怎么实现的比较好奇，因此看看具体是怎么操作的。</p>\\n<h2>实操</h2>\\n<p><code>nginx</code> 提供了 <code>sub_filter</code> 模块来实现重写 content 的功能。</p>\\n<p>我们需要找到 <code>nginx</code> 的安装目录，进入其 <code>conf</code> 文件夹，打开 <code>nginx.conf</code> 配置文件。</p>","autoDesc":true}');export{l as comp,p as data};
